---
import Head from '@Components/Head.astro';
import { sortPostByDate, getPostWithCompiledSummary } from '@Tools/post';
import type { Post } from '@Models/GeneralTypes';

const allPosts = await Astro.glob<Post>('../pages/posts/**/*.md');
const sortedPosts = sortPostByDate(allPosts);
const firstTenPosts = sortedPosts.slice(0, 10);
const postsWithCompiledSummary = getPostWithCompiledSummary(firstTenPosts);
---

<html lang="en">
  <Head title="普通文組 2.0" description="tzyn blog v2 index" />
  <body>
    <h1>普通文組 2.0</h1>
    {
      postsWithCompiledSummary.map((post) => (
        <li>
          <a href={post.url}>{post.frontmatter.title}</a>
          <div>{post.frontmatter.date}</div>
          <ul>
            {post.frontmatter.tag.map((tag) => (
              <li>{tag}</li>
            ))}
          </ul>
          {post.frontmatter.banner && <img src={post.frontmatter.banner} />}
          <div set:html={post.summary} />
        </li>
      ))
    }
  </body>
</html>
