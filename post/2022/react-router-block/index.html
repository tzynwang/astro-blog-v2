<!DOCTYPE html>
<html lang="en" class="astro-D4ZPMAD2">
  <head>
    <!-- Global Metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="sitemap" href="/sitemap-index.xml">
    <meta name="generator" content="Astro v2.10.12">

    <!-- Primary Meta Tags -->
    <title>2022 ç¬¬7é€± å¯¦ä½œç­†è¨˜ï¼šåœ¨é›¢é–‹è·¯ç”±å‰é¡¯ç¤ºç¢ºèªè¦–çª—</title>
    <meta name="title" content="2022 ç¬¬7é€± å¯¦ä½œç­†è¨˜ï¼šåœ¨é›¢é–‹è·¯ç”±å‰é¡¯ç¤ºç¢ºèªè¦–çª—">
    <meta name="description" content="">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tzynwang.github.io/post/2022/react-router-block/">
    <meta property="og:title" content="2022 ç¬¬7é€± å¯¦ä½œç­†è¨˜ï¼šåœ¨é›¢é–‹è·¯ç”±å‰é¡¯ç¤ºç¢ºèªè¦–çª—">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tzynwang.github.io/post/2022/react-router-block/">
    <meta property="twitter:title" content="2022 ç¬¬7é€± å¯¦ä½œç­†è¨˜ï¼šåœ¨é›¢é–‹è·¯ç”±å‰é¡¯ç¤ºç¢ºèªè¦–çª—">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/_astro/index.5f60e57f.css" />
<link rel="stylesheet" href="/_astro/2-1-movie-list-i18n-note.5f900e92.css" /></head>
  <body class="astro-D4ZPMAD2">
    <section class="side-contnet astro-D4ZPMAD2">
      <h1 class="astro-D4ZPMAD2">æ™®é€šæ–‡çµ„ 2.0</h1>
      <nav class="astro-D4ZPMAD2">
        <a href="/" class="astro-D4ZPMAD2">é¦–é </a>
        <a href="/archive" class="astro-D4ZPMAD2">å…¨æ–‡ç« æ­¸æª”</a>
      </nav>
    </section>
    <section class="main-content astro-D4ZPMAD2">
      
  <div class="post-container astro-QTOKGA5Y">
    <h1 class="astro-QTOKGA5Y">2022 ç¬¬7é€± å¯¦ä½œç­†è¨˜ï¼šåœ¨é›¢é–‹è·¯ç”±å‰é¡¯ç¤ºç¢ºèªè¦–çª—</h1>
    <div class="info astro-QTOKGA5Y">
      <span class="astro-QTOKGA5Y">2022-02-16 18:30</span>
      <span class="astro-QTOKGA5Y"><span class="astro-2IYMVI75">
  React
</span><span class="astro-2IYMVI75">
  webpack
</span></span>
      <ul class="astro-QTOKGA5Y">
        <li class="toc-2 astro-QTOKGA5Y">
              <a href="#ç¸½çµ" class="astro-QTOKGA5Y">ç¸½çµ</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#ç‰ˆæœ¬" class="astro-QTOKGA5Y">ç‰ˆæœ¬</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#ç­†è¨˜" class="astro-QTOKGA5Y">ç­†è¨˜</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#useblock" class="astro-QTOKGA5Y">useBlock</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#ç„¡æ¢ä»¶é˜»æ“‹about-å…ƒä»¶" class="astro-QTOKGA5Y">ç„¡æ¢ä»¶é˜»æ“‹ï¼šAbout å…ƒä»¶</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#æœ‰æ¢ä»¶é˜»æ“‹form-å…ƒä»¶" class="astro-QTOKGA5Y">æœ‰æ¢ä»¶é˜»æ“‹ï¼šForm å…ƒä»¶</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#webpack-devserver-è¨­å®š" class="astro-QTOKGA5Y">webpack devServer è¨­å®š</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#åƒè€ƒæ–‡ä»¶" class="astro-QTOKGA5Y">åƒè€ƒæ–‡ä»¶</a>
            </li>
      </ul>
    </div>
    <h2 id="ç¸½çµ">ç¸½çµ</h2>
<p>æœ¬ç¯‡ç­†è¨˜è¨˜éŒ„å¦‚ä½•ä½¿ç”¨ react-router-dom (v5) çš„ <code>useHistory()</code> èˆ‡ Web API <code>beforeunload</code> event åœ¨ä»¥ä¸‹æ™‚é–“é»è·³å‡ºç¢ºèªè¨Šæ¯ï¼š</p>
<ul>
<li>ä½¿ç”¨è€…é»æ“Šé‡æ–°æ•´ç†ï¼ˆ<code>beforeunload</code>ï¼‰</li>
<li>ä½¿ç”¨è€…é—œé–‰åˆ†é ï¼ˆ<code>beforeunload</code>ï¼‰</li>
<li>ä½¿ç”¨è€…æŒ‰ä¸‹ã€Œä¸Šï¼ˆä¸‹ï¼‰ä¸€é ã€æº–å‚™é›¢é–‹ç•¶ä¸‹ç•«é¢ï¼ˆ<code>history.block()</code>ï¼‰</li>
</ul>
<p><img src="/2022/react-router-block/react-router-block-demo.gif" alt="leave prompt"></p>
<p>åŸå§‹ç¢¼ï¼š<a href="https://github.com/tzynwang/react-router-block/tree/version/2">https://github.com/tzynwang/react-router-block/tree/version/2</a></p>
<h2 id="ç‰ˆæœ¬">ç‰ˆæœ¬</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">react-router-dom: 5.3.0</span></span>
<span class="line"><span style="color: #e1e4e8">webpack: 5.69.0</span></span></code></pre>
<h2 id="ç­†è¨˜">ç­†è¨˜</h2>
<h3 id="useblock">useBlock</h3>
<script src="https://gist.github.com/tzynwang/64078bcedb90e4b1e17479d45bbca97d.js"></script>
<ul>
<li>
<p><code>beforeunload</code> èƒ½åµæ¸¬çš„æ˜¯ã€Œé‡æ–°æ•´ç†ã€èˆ‡ã€Œé—œé–‰åˆ†é ã€é€™å…©ç¨®è¡Œç‚ºï¼Œè€Œä½¿ç”¨è€…é»æ“Šã€Œä¸Šï¼ˆä¸‹ï¼‰ä¸€é ã€æœƒç”± <code>useHistory()</code> ç”¢ç”Ÿçš„ <code>history</code> instance ä¾†é˜»æ“‹</p>
</li>
<li>
<p>å¾ args å‚³å…¥ <code>block</code> åƒæ•¸ï¼Œè®“ useBlock å¯ä»¥åœ¨ç‰¹å®šæ¢ä»¶ä¸‹è§£é™¤é˜»æ“‹è¡Œç‚ºï¼ˆä¾‹ï¼šä½¿ç”¨è€…å·²ç¶“å¡«å®Œè¡¨å–®æ‰€æœ‰å…§å®¹ï¼‰</p>
</li>
<li>
<p>ç¬¬ 25-31 è¡Œï¼šç•¶å¼•ç”¨ useBlock çš„å…ƒä»¶æ›è¼‰è‡³ç•«é¢ä¸Šæ™‚ï¼Œå°‡ <code>history.block()</code> å›å‚³çš„ instance ä¿å­˜åˆ°è®Šæ•¸ <code>BLOCK</code> ä¸­ï¼Œä¸¦åœ¨å¼•ç”¨ useBlock çš„å…ƒä»¶å¾ç•«é¢ä¸Šå¸è¼‰æ™‚ï¼ŒåŸ·è¡Œ <code>BLOCK</code></p>
</li>
<li>
<p>ç¬¬ 26 è¡Œï¼šä½¿ç”¨ <code>window.confirm</code> å½ˆå‡ºç€è¦½å™¨åŸç”Ÿçš„å°è©±æ¡†ï¼Œè©¢å•ä½¿ç”¨è€…æ˜¯å¦é›¢é–‹ç¶²é ï¼Œé¸æ“‡ä¸é›¢é–‹ï¼ˆ<code>!leave</code>ï¼‰å‰‡å›å‚³ <code>false</code> å–æ¶ˆé›¢é–‹çš„è¡Œç‚º</p>
</li>
<li>
<p>åƒè€ƒ <code>@types/history</code> å¯å¾—çŸ¥ <code>history.block()</code> èˆ‡å…¶ args çš„ type åˆ†åˆ¥å¦‚ä¸‹åˆ—ï¼š</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">History</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">HistoryLocationState</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">LocationState</span><span style="color: #E1E4E8">> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">block</span><span style="color: #E1E4E8">(</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #FFAB70">prompt</span><span style="color: #F97583">?:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">boolean</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">TransitionPromptHook</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">HistoryLocationState</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">  )</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">UnregisterCallback</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">type</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">TransitionPromptHook</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">S</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">LocationState</span><span style="color: #E1E4E8">> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">location</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Location</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">S</span><span style="color: #E1E4E8">>,</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">action</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Action</span></span>
<span class="line"><span style="color: #E1E4E8">) </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">false</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">void</span><span style="color: #E1E4E8">;</span></span></code></pre>
<p>ç‚ºäº†è®“ type check ä¸æœƒå ±éŒ¯ï¼Œåœ¨ä½¿ç”¨è€…ç¢ºèªé›¢é–‹ç•«é¢æ™‚ï¼Œè®“å‚³å…¥ <code>history.block()</code> çš„åŒ¿åå‡½å¼å›å‚³ <code>undefined</code> è€Œé <code>true</code>ï¼ˆç¬¬ 30 è¡Œï¼‰</p>
</li>
</ul>
<h3 id="ç„¡æ¢ä»¶é˜»æ“‹about-å…ƒä»¶">ç„¡æ¢ä»¶é˜»æ“‹ï¼šAbout å…ƒä»¶</h3>
<script src="https://gist.github.com/tzynwang/fe1c004da511941c3e1cb83723c98f93.js"></script>
<p>ç›´æ¥åœ¨å…ƒä»¶ä¸­å‘¼å« <code>useBlock()</code>ï¼Œä¸¦å‚³å…¥ç©ºç‰©ä»¶ï¼ˆä¸éœ€è§£é™¤æ¢ä»¶ï¼‰</p>
<h3 id="æœ‰æ¢ä»¶é˜»æ“‹form-å…ƒä»¶">æœ‰æ¢ä»¶é˜»æ“‹ï¼šForm å…ƒä»¶</h3>
<script src="https://gist.github.com/tzynwang/d31470f3de89cf5ac39e4b3f1dbf2eda.js"></script>
<p>å‚³å…¥ <code>useState</code> è®Šæ•¸ <code>block</code>ï¼Œåœ¨ä½¿ç”¨è€…æŒ‰ä¸‹é€å‡ºè¡¨å–®çš„æŒ‰éˆ•æ™‚ï¼Œå°‡ <code>block</code> è¨­å®šç‚º <code>false</code>ï¼Œä¸¦åœ¨ç•«é¢é‡æ–°æ•´ç†ï¼ˆå…ƒä»¶é‡æ–°æ›è¼‰åˆ°ç•«é¢ä¸Šå¾Œï¼‰ï¼Œé‡è¨­ <code>block</code> ç‚º <code>true</code> é¿å… F5 å¾Œé˜»æ“‹å¤±æ•ˆ</p>
<h3 id="webpack-devserver-è¨­å®š">webpack devServer è¨­å®š</h3>
<ul>
<li>åœ¨å¾Œç«¯ server æ²’æœ‰é…åˆçš„æƒ…æ³ä¸‹ï¼Œä½¿ç”¨ <code>BrowserRouter</code> ä¾†è™•ç†è·¯ç”±æœƒå°è‡´ç•«é¢é‡æ–°æ•´ç†ã€æˆ–æ˜¯ä½¿ç”¨è€…ç›´æ¥è¼¸å…¥è·¯ç”±æ™‚é­é‡ 404</li>
<li>å¦‚æœåœ¨é–‹ç™¼æ™‚ä½¿ç”¨ webpack devServer ä¾†åŸ·è¡Œ react APPï¼Œå‰‡è¨­å®š <code>webpack.config.js</code> çš„ <code>devServer</code> å…¶ <code>historyApiFallback: true</code> å³å¯ä½¿ç”¨ <code>BrowserRouter</code>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #B392F0">devServer</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">historyApiFallback</span><span style="color: #E1E4E8">: </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
</li>
<li>è‹¥ react APP æ˜¯éƒ¨ç½²åˆ° GitHub Pagesï¼ˆæˆ–ä»»ä½•ç„¡æ³•é…åˆ history mode çš„ serverï¼‰å‰‡éœ€ä½¿ç”¨ <code>react-router-dom</code> çš„ <code>HashRouter</code> ä¾†è™•ç†è·¯ç”±ï¼Œè€Œè·¯ç”±æœƒå¸¶ä¸Šäº•å­—è™Ÿ</li>
</ul>
<h2 id="åƒè€ƒæ–‡ä»¶">åƒè€ƒæ–‡ä»¶</h2>
<ul>
<li><a href="https://v5.reactrouter.com/web/api/history">react-router v5: history</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event">MDN: beforeunload event</a></li>
<li><a href="https://stackoverflow.com/questions/65526447/react-router-v5-2-blocking-route-change-with-createbrowserhistory-and-history">React Router v5.2 - Blocking route change with createBrowserHistory and history.block</a></li>
<li><a href="https://stackoverflow.com/questions/27928372/react-router-urls-dont-work-when-refreshing-or-writing-manually">React-router urls donâ€™t work when refreshing or writing manually</a></li>
</ul>
  </div>

      <footer class="astro-QLGQ3ONJ">Tzu Yin (Charlie) ğŸ¦Š Made in Taiwan</footer>
    </section>
  </body></html>