<!DOCTYPE html>
<html lang="en" class="astro-D4ZPMAD2">
  <head>
    <!-- Global Metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="sitemap" href="/sitemap-index.xml">
    <meta name="generator" content="Astro v2.10.12">

    <!-- Primary Meta Tags -->
    <title>從零開始重寫：餐廳清單（Express版）路由、METHODS重構</title>
    <meta name="title" content="從零開始重寫：餐廳清單（Express版）路由、METHODS重構">
    <meta name="description" content="">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tzynwang.github.io/post/2021/express-restaurant-list-1/">
    <meta property="og:title" content="從零開始重寫：餐廳清單（Express版）路由、METHODS重構">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tzynwang.github.io/post/2021/express-restaurant-list-1/">
    <meta property="twitter:title" content="從零開始重寫：餐廳清單（Express版）路由、METHODS重構">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/_astro/index.5f60e57f.css" />
<link rel="stylesheet" href="/_astro/2-1-movie-list-i18n-note.5f900e92.css" /></head>
  <body class="astro-D4ZPMAD2">
    <section class="side-contnet astro-D4ZPMAD2">
      <h1 class="astro-D4ZPMAD2">普通文組 2.0</h1>
      <nav class="astro-D4ZPMAD2">
        <a href="/" class="astro-D4ZPMAD2">首頁</a>
        <a href="/archive" class="astro-D4ZPMAD2">全文章歸檔</a>
      </nav>
    </section>
    <section class="main-content astro-D4ZPMAD2">
      
  <div class="post-container astro-QTOKGA5Y">
    <h1 class="astro-QTOKGA5Y">從零開始重寫：餐廳清單（Express版）路由、METHODS重構</h1>
    <div class="info astro-QTOKGA5Y">
      <span class="astro-QTOKGA5Y">2021-06-22 14:06</span>
      <span class="astro-QTOKGA5Y"><span class="astro-2IYMVI75">
  Express
</span><span class="astro-2IYMVI75">
  HTML
</span></span>
      <ul class="astro-QTOKGA5Y">
        <li class="toc-2 astro-QTOKGA5Y">
              <a href="#總結" class="astro-QTOKGA5Y">總結</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#環境" class="astro-QTOKGA5Y">環境</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#筆記" class="astro-QTOKGA5Y">筆記</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#路由重構" class="astro-QTOKGA5Y">路由重構</a>
            </li><li class="toc-4 astro-QTOKGA5Y">
              <a href="#appjs" class="astro-QTOKGA5Y">app.js</a>
            </li><li class="toc-4 astro-QTOKGA5Y">
              <a href="#routesindexjs" class="astro-QTOKGA5Y">routes/index.js</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#methods-重構" class="astro-QTOKGA5Y">METHODS 重構</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#browserify-流程記錄" class="astro-QTOKGA5Y">browserify 流程記錄</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#補充" class="astro-QTOKGA5Y">補充</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#method-patch-put" class="astro-QTOKGA5Y">Method: PATCH, PUT</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#idempotent" class="astro-QTOKGA5Y">Idempotent</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#參考文件" class="astro-QTOKGA5Y">參考文件</a>
            </li>
      </ul>
    </div>
    <h2 id="總結">總結</h2>
<p>本篇為餐廳清單（Express 版）的路由、METHODS 重構，以及使用<code>browserify</code>搭配<code>axios</code>實現 in-browser <code>require()</code>之相關筆記</p>
<h2 id="環境">環境</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">browserify: 17.0.0</span></span>
<span class="line"><span style="color: #e1e4e8">os: Windows_NT 10.0.18363 win32 x64</span></span></code></pre>
<h2 id="筆記">筆記</h2>
<p><img src="/2021/express-restaurant-list-1/folderStructure.png" alt="重構後的資料夾結構"></p>
<h3 id="路由重構">路由重構</h3>
<script src="https://gist.github.com/tzynwang/708c0d129d912f54e8043e62cb9e751a.js"></script>
<h4 id="appjs">app.js</h4>
<ul>
<li>第 6 行：將 DB 連線設定搬移到 config 資料夾中</li>
<li>13-15 行：為配合 axios 的 POST request，將<code>body-parser</code>加回來</li>
<li>37-38 行：將路由移動到 routes 資料夾中</li>
</ul>
<h4 id="routesindexjs">routes/index.js</h4>
<ul>
<li>4-5 行：routes/modules 中的 home.js 與 restaurants.js 皆分別在檔案結尾進行<code>module.exports = router</code>，讓 index.js 可引用之</li>
<li>7-8 行：分別將對<code>/</code>與<code>/restaurant</code>的請求導向<code>home</code>與<code>restaurant</code></li>
<li>第 10 行：將 index.js 本身也進行匯出，使 app.js 可使用之（app.js 中第 37 行）</li>
</ul>
<h3 id="methods-重構">METHODS 重構</h3>
<ul>
<li>
<p>參考 app.js 第 33-34 行，引用<code>method-override</code>後，使用 override using a query value 的方式複寫 METHOD
<a href="http://expressjs.com/en/resources/middleware/method-override.html">官方說明</a>：</p>
<blockquote>
<p>To use a query string value to override the method, specify the query string key as a string argument to the methodOverride function. To then make the call, send a <strong>POST request</strong> to a URL with the overridden method as the value of that query string key. This method of using a query value would typically be used in conjunction with plain HTML <code>&#x3C;form></code> elements when trying to support legacy browsers but still use newer methods.</p>
</blockquote>
<p>官方示範程式碼：</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">express</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">require</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'express'</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">methodOverride</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">require</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'method-override'</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">app</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">express</span><span style="color: #E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// override with POST having ?_method=DELETE</span></span>
<span class="line"><span style="color: #E1E4E8">app.</span><span style="color: #B392F0">use</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">methodOverride</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'_method'</span><span style="color: #E1E4E8">));</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">form</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">method</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"POST"</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">action</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"/resource?_method=DELETE"</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;</span><span style="color: #85E89D">button</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">type</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"submit"</span><span style="color: #E1E4E8">>Delete resource&#x3C;/</span><span style="color: #85E89D">button</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">form</span><span style="color: #E1E4E8">></span></span></code></pre>
</li>
<li>
<p>將 form action 設定完畢後，原本的 POST request 就會（根據 query string value）被覆寫為 DELETE 與 PUT 等 METHOD</p>
</li>
<li>
<p>之後即可在後端使用<code>router.delete</code>或<code>router.put</code>等方式處理相關請求</p>
</li>
</ul>
<h3 id="browserify-流程記錄">browserify 流程記錄</h3>
<ol>
<li>安裝 browserify 與 axios</li>
<li>在 public/scripts 資料夾中建立一檔案 sort.js，內容如下</li>
</ol>
<script src="https://gist.github.com/tzynwang/f034770c2ca9f0cc16edc449f44a1f94.js"></script>
<ol>
<li>在沒有搭配 browserify 的情況下，直接引用 sort.js 檔案會在瀏覽器 console 看到<code>ReferenceError: require is not defined</code>此錯誤訊息，相關討論參考：<a href="https://stackoverflow.com/questions/19059580/client-on-node-js-uncaught-referenceerror-require-is-not-defined">Client on Node.js: Uncaught ReferenceError: require is not defined</a></li>
<li>參考 browserify 的<a href="https://github.com/browserify/browserify#example">GitHub README</a>，在終端輸入<code>browserify public/scripts/sort.js > public/scripts/sortBundle.js</code>將 sort.js 與 axios 等額外 require 的模組 bundle 在一起</li>
<li>最終在前端網頁引用<code>sortBundle.js</code>此檔案，錯誤訊息消失，問題解決</li>
</ol>
<h2 id="補充">補充</h2>
<h3 id="method-patch-put">Method: PATCH, PUT</h3>
<ul>
<li>A <code>PATCH</code> request is considered a set of <strong>instructions on how to modify a resource</strong>. Contrast this with <code>PUT</code>; which is a complete <strong>representation of a resource</strong>.</li>
<li>A <code>PATCH</code> is <strong>not necessarily idempotent</strong>, although it can be. Contrast this with <code>PUT</code>; which is <strong>always idempotent</strong>. The word “idempotent” means that any number of repeated, identical requests will leave the resource in the same state. (不像<code>POST</code> request 如果連續發送可能會變成多筆訂單，多次發送<code>PUT</code> request 不會有類似的後遺症)</li>
<li>Calling <code>PUT</code> method <strong>once or several times successively has the same effect</strong> (that is no side effect), this method is <strong>idempotent</strong>; whereas successive identical <code>POST</code> requests may have additional effects, akin to placing an order several times.</li>
</ul>
<h3 id="idempotent">Idempotent</h3>
<ul>
<li>Description of common <strong>idempotent methods</strong>: GET, HEAD, PUT, DELETE, OPTIONS, TRACE</li>
<li>Description of common <strong>non-idempotent</strong> methods: POST,PATCH, CONNECT
<ul>
<li>Reference: <a href="https://developer.mozilla.org/en-US/docs/Glossary/Idempotent">https://developer.mozilla.org/en-US/docs/Glossary/Idempotent</a></li>
</ul>
</li>
<li>A request method is considered “idempotent” if the intended effect on the server of multiple identical requests with that method is the same as the effect for a single such request. (對 server 打一次或多次的結果如果都一樣，該 HTTP method 就會被認為是 idempotent) Of the request methods defined by this specification, PUT, DELETE, and safe request methods (GET, HEAD, OPTIONS) are idempotent.
<ul>
<li>Reference: <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.2">https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.2</a></li>
</ul>
</li>
</ul>
<h2 id="參考文件">參考文件</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/6971583/node-style-require-for-in-browser-javascript/11588570">Node-style require for in-browser javascript?</a></li>
<li><a href="https://github.com/browserify/browserify#browserify">GitHub: browserify</a></li>
<li>MDN
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PATCH">PATCH</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT">PUT</a></li>
</ul>
</li>
</ul>
  </div>

      <footer class="astro-QLGQ3ONJ">Tzu Yin (Charlie) 🦊 Made in Taiwan</footer>
    </section>
  </body></html>