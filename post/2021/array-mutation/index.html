<!DOCTYPE html>
<html lang="en" class="astro-D4ZPMAD2">
  <head>
    <!-- Global Metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="sitemap" href="/sitemap-index.xml">
    <meta name="generator" content="Astro v2.10.12">

    <!-- Primary Meta Tags -->
    <title>為什麼可以修改使用const宣告的陣列（或物件）的內容？</title>
    <meta name="title" content="為什麼可以修改使用const宣告的陣列（或物件）的內容？">
    <meta name="description" content="">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tzynwang.github.io/post/2021/array-mutation/">
    <meta property="og:title" content="為什麼可以修改使用const宣告的陣列（或物件）的內容？">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tzynwang.github.io/post/2021/array-mutation/">
    <meta property="twitter:title" content="為什麼可以修改使用const宣告的陣列（或物件）的內容？">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/_astro/index.5f60e57f.css" />
<link rel="stylesheet" href="/_astro/2-1-movie-list-i18n-note.5f900e92.css" /></head>
  <body class="astro-D4ZPMAD2">
    <section class="side-contnet astro-D4ZPMAD2">
      <h1 class="astro-D4ZPMAD2">普通文組 2.0</h1>
      <nav class="astro-D4ZPMAD2">
        <a href="/" class="astro-D4ZPMAD2">首頁</a>
        <a href="/archive" class="astro-D4ZPMAD2">全文章歸檔</a>
      </nav>
    </section>
    <section class="main-content astro-D4ZPMAD2">
      
  <div class="post-container astro-QTOKGA5Y">
    <h1 class="astro-QTOKGA5Y">為什麼可以修改使用const宣告的陣列（或物件）的內容？</h1>
    <div class="info astro-QTOKGA5Y">
      <span class="astro-QTOKGA5Y">2021-04-09 14:23</span>
      <span class="astro-QTOKGA5Y"><span class="astro-2IYMVI75">
  JavaScript
</span></span>
      <ul class="astro-QTOKGA5Y">
        <li class="toc-2 astro-QTOKGA5Y">
              <a href="#原始問題" class="astro-QTOKGA5Y">原始問題</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#簡答" class="astro-QTOKGA5Y">簡答</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#環境" class="astro-QTOKGA5Y">環境</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#關於const的事實" class="astro-QTOKGA5Y">關於const的事實</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#you-dont-know-js-yet-相關筆記" class="astro-QTOKGA5Y">You Don’t Know JS Yet 相關筆記</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#es2015-const-is-not-about-immutability-相關筆記" class="astro-QTOKGA5Y">ES2015 const is not about immutability 相關筆記</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#mdn-上的相關內容" class="astro-QTOKGA5Y">MDN 上的相關內容</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#objectfreeze" class="astro-QTOKGA5Y">Object.freeze()</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#objectseal" class="astro-QTOKGA5Y">Object.seal()</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#objectpreventextensions" class="astro-QTOKGA5Y">Object.preventExtensions()</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#objectgetownpropertydescriptor" class="astro-QTOKGA5Y">Object.getOwnPropertyDescriptor()</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#補充無法解凍或再開封" class="astro-QTOKGA5Y">補充：無法解凍或再開封</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#參考文件" class="astro-QTOKGA5Y">參考文件</a>
            </li>
      </ul>
    </div>
    <h2 id="原始問題">原始問題</h2>
<p>以<code>const</code>宣告一個陣列（或物件），為何可以在宣告完畢後繼續修改該陣列（或物件）的內容？</p>
<p><img src="/2021/array-mutation/%E9%A8%8E%E5%A3%AB%E7%8E%8B%E7%9A%84%E6%8F%90%E5%95%8F%E6%99%82%E9%96%93.jpg" alt="事實上const的限制是「變數不能被re-assigned或re-declared」"></p>
<h2 id="簡答">簡答</h2>
<p><code>const</code>的限制是「只能賦值一次，不能重新賦值」，不直接等同「不能修改內容」。</p>
<h2 id="環境">環境</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">Google Chrome: 89.0.4389.114 (Official Build) (64-bit)</span></span>
<span class="line"><span style="color: #e1e4e8">os: Windows_NT 10.0.18363 win32 x64</span></span></code></pre>
<h2 id="關於const的事實">關於<code>const</code>的事實</h2>
<h3 id="you-dont-know-js-yet-相關筆記">You Don’t Know JS Yet 相關筆記</h3>
<ul>
<li>
<p><code>const</code> declared variables are not “unchangeable”, they just cannot be re-assigned.</p>
<ul>
<li>不適合以「不能被修改」來理解透過<code>const</code>宣告的變數，而是「使用<code>const</code>宣告的變數只能被賦值一次」</li>
</ul>
<script src="https://gist.github.com/tzynwang/bf4ef105981d115a11ae4eb761e34ac8.js"></script>
</li>
<li>
<p>It’s ill-advised to use <code>const</code> with object values, because those values can still be changed even though the variable can’t be re-assigned.</p>
</li>
</ul>
<script src="https://gist.github.com/tzynwang/b7f3ee4e1e7c8936a98bb8f7fa76b634.js"></script>
<ul>
<li>If you stick to using <code>const</code> only with primitive values, you avoid any confusion of re-assignment (not allowed) vs. mutation (allowed)! That’s the safest and best way to use const.</li>
</ul>
<h3 id="es2015-const-is-not-about-immutability-相關筆記">ES2015 const is not about immutability 相關筆記</h3>
<script src="https://gist.github.com/tzynwang/0945c27501de984d3aaa410bf55a08ce.js"></script>
<ul>
<li>The only thing that’s immutable here is the binding. <code>const</code> assigns a value (<code>{}</code>) to a variable name (<code>foo</code>), and guarantees that no rebinding will happen. ES2015 const has nothing to do with immutability of values.</li>
<li>與其描述為「透過<code>const</code>宣告的陣列（或物件）不能被修改內容」，不如將<code>const</code>理解為「建立一個變數與值之間不變的 binding」。</li>
</ul>
<h3 id="mdn-上的相關內容">MDN 上的相關內容</h3>
<ul>
<li>The value of a constant can’t be changed through reassignment, and it can’t be re-declared.</li>
<li>以<code>const</code>宣告變數的同時就得賦值
<script src="https://gist.github.com/tzynwang/b92649f9945fb3cb92275cf448adb199.js"></script>
</li>
</ul>
<h2 id="objectfreeze"><code>Object.freeze()</code></h2>
<ul>
<li>如果想要確保陣列或物件內容不被修改，可以使用<code>Object.freeze()</code>
<ul>
<li>MDN: Use <code>Object.freeze()</code> to make object immutable. A frozen object can no longer be changed; freezing an object prevents new properties from being added to it, existing properties from being removed, prevents changing the enumerability, configurability, or writability of existing properties, and prevents the values of existing properties from being changed.</li>
<li>一個陣列或物件被凍結後，無法新增或移除該陣列、物件的內容，也不可修改該陣列、物件的 properties</li>
</ul>
</li>
<li><code>Object.freeze()</code>不會自動套用到巢狀結構內的所有內容上，如以下範例：
<script src="https://gist.github.com/tzynwang/a52efc027532899027d7d0e0c9f1cfef.js"></script>
<img src="/2021/array-mutation/object-freeze-demo-1.png" alt="Object.freeze() demo 1"></li>
<li>可透過遞迴來凍結巢狀結構物件的內容
<script src="https://gist.github.com/tzynwang/e7a3cf50d030d90f05eee59257806b1e.js"></script>
<img src="/2021/array-mutation/object-freeze-demo-2.png" alt="Object.freeze() demo 2"></li>
</ul>
<h2 id="objectseal"><code>Object.seal()</code></h2>
<ul>
<li>The Object.seal() method seals an object, preventing new properties from being added to it and marking all existing properties as non-configurable. Values of present properties can still be changed as long as they are writable.
<ul>
<li>與<code>Object.freeze()</code>的差異是，經<code>Object.seal()</code>封閉的物件，不能對其新增或刪除內容，但封閉前就存在的內容可以被修改
<script src="https://gist.github.com/tzynwang/1e8917a16a8450fb76fd5a6bd34201e9.js"></script>
<img src="/2021/array-mutation/object-freeze-demo-3.png" alt="Object.freeze() demo 3"></li>
</ul>
</li>
</ul>
<h2 id="objectpreventextensions"><code>Object.preventExtensions()</code></h2>
<p><code>Object.preventExtensions()</code>只會禁止對物件新增內容，但可以刪除或修改既有內容</p>
<script src="https://gist.github.com/tzynwang/034ffb5ed714a851cc2e35c5b8a148df.js"></script>
<p><img src="/2021/array-mutation/object-freeze-demo-4.png" alt="Object.freeze() demo 4"></p>
<h2 id="objectgetownpropertydescriptor"><code>Object.getOwnPropertyDescriptor()</code></h2>
<p>回傳一物件中某內容的相關設定</p>
<script src="https://gist.github.com/tzynwang/e0618d9ef2d4fa0b153ad6d9347ae8ee.js"></script>
<p><img src="/2021/array-mutation/object-freeze-demo-5.png" alt="Object.freeze() demo 5"></p>
<p>參考<a href="https://tc39.es/ecma262/#table-data-property-attributes">ECMAScript Specification, Table 3: Attributes of a Data Property</a>：</p>
<ul>
<li><code>writable</code>: If false, attempts by ECMAScript code to change the property’s [[Value]] attribute using [[Set]] will not succeed.
<ul>
<li><code>writable</code>若為<code>false</code>，代表該<code>value</code>無法被修改</li>
<li>被<code>Object.freeze()</code>凍結的物件，其<code>value</code>的<code>writable</code>就被修改為<code>false</code></li>
</ul>
</li>
<li><code>enumerable</code>: If true, the property will be enumerated by a for-in enumeration. Otherwise, the property is said to be non-enumerable.
<ul>
<li><code>enumerable</code>為<code>true</code>代表該<code>value</code>會<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in">被<code>for...in</code>遍歷</a></li>
</ul>
</li>
<li><code>configurable</code>: If false, attempts to delete the property, change the property to be an accessor property, or change its attributes (other than <code>[[Value]]</code>, or changing <code>[[Writable]]</code> to false) will fail.
<ul>
<li><code>configurable</code>若為<code>false</code>，代表該<code>value</code>無法被刪除</li>
<li>經<code>Object.freeze()</code>或<code>Object.seal()</code>處理過的物件，其<code>value</code>的<code>configurable</code>就被修改為<code>false</code>
<img src="/2021/array-mutation/attributes-of-data-property.png" alt="attributes of data property"></li>
</ul>
</li>
</ul>
<h2 id="補充無法解凍或再開封">補充：無法解凍或再開封</h2>
<p><a href="https://stackoverflow.com/questions/19293321/opposite-of-object-freeze-or-object-seal-in-javascript">Opposite of Object.freeze or Object.seal in JavaScript</a></p>
<blockquote>
<p>Freezing an object is the ultimate form of lock-down. Once an object has been frozen it cannot be unfrozen – nor can it be tampered in any manner. This is the best way to make sure that your objects will stay exactly as you left them, indefinitely</p>
</blockquote>
<ul>
<li><code>Object.freeze()</code>與<code>Object.seal()</code>是不可逆的程序，一旦一個物件（或陣列）被凍結或封閉，該物件就無法回到凍結（或封閉）前的狀態</li>
<li>可以透過<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign"><code>Object.assign()</code></a>來製作該物件（或陣列）的副本，再修改其內容</li>
</ul>
<h2 id="參考文件">參考文件</h2>
<ul>
<li>You Don’t Know JS Yet: Get Started - 2nd Edition
<ul>
<li><a href="https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/get-started/ch2.md">Chapter 2: Surveying JS</a></li>
<li><a href="https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/get-started/apA.md">Appendix A: Exploring Further</a></li>
</ul>
</li>
<li><a href="https://mathiasbynens.be/notes/es6-const">ES2015 const is not about immutability</a></li>
<li>MDN
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const">const</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">Object.freeze()</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/seal">Object.seal()</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions">Object.preventExtensions()</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">Object.getOwnPropertyDescriptor()</a></li>
</ul>
</li>
<li><a href="https://stackoverflow.com/questions/7509894/freezing-arrays-in-javascript">‘Freezing’ Arrays in Javascript?</a></li>
</ul>
  </div>

      <footer class="astro-QLGQ3ONJ">Tzu Yin (Charlie) 🦊 Made in Taiwan</footer>
    </section>
  </body></html>