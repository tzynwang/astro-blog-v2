<!DOCTYPE html>
<html lang="en" class="astro-D4ZPMAD2">
  <head>
    <!-- Global Metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="sitemap" href="/sitemap-index.xml">
    <meta name="generator" content="Astro v2.10.12">

    <!-- Primary Meta Tags -->
    <title>閱讀筆記：Good Code, Bad Code Chapter 9 Make code reusable and generalizable</title>
    <meta name="title" content="閱讀筆記：Good Code, Bad Code Chapter 9 Make code reusable and generalizable">
    <meta name="description" content="">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tzynwang.github.io/post/2023/good-code-bad-code-ch9-make-code-reusable-and-generalizable/">
    <meta property="og:title" content="閱讀筆記：Good Code, Bad Code Chapter 9 Make code reusable and generalizable">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tzynwang.github.io/post/2023/good-code-bad-code-ch9-make-code-reusable-and-generalizable/">
    <meta property="twitter:title" content="閱讀筆記：Good Code, Bad Code Chapter 9 Make code reusable and generalizable">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg">

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/_astro/index.5f60e57f.css" />
<link rel="stylesheet" href="/_astro/2-1-movie-list-i18n-note.5f900e92.css" /></head>
  <body class="astro-D4ZPMAD2">
    <section class="side-contnet astro-D4ZPMAD2">
      <h1 class="astro-D4ZPMAD2">普通文組 2.0</h1>
      <nav class="astro-D4ZPMAD2">
        <a href="/" class="astro-D4ZPMAD2">首頁</a>
        <a href="/archive" class="astro-D4ZPMAD2">全文章歸檔</a>
      </nav>
    </section>
    <section class="main-content astro-D4ZPMAD2">
      
  <div class="post-container astro-QTOKGA5Y">
    <h1 class="astro-QTOKGA5Y">閱讀筆記：Good Code, Bad Code Chapter 9 Make code reusable and generalizable</h1>
    <div class="info astro-QTOKGA5Y">
      <span class="astro-QTOKGA5Y">2023-04-12 19:24</span>
      <span class="astro-QTOKGA5Y"><span class="astro-2IYMVI75">
  Software Architecture
</span></span>
      <ul class="astro-QTOKGA5Y">
        <li class="toc-2 astro-QTOKGA5Y">
              <a href="#總結" class="astro-QTOKGA5Y">總結</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#筆記" class="astro-QTOKGA5Y">筆記</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#避免假設" class="astro-QTOKGA5Y">避免假設</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#避免全域狀態" class="astro-QTOKGA5Y">避免全域狀態</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#謹慎處理預設回傳內容" class="astro-QTOKGA5Y">謹慎處理預設回傳內容</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#避免非必要的參數" class="astro-QTOKGA5Y">避免非必要的參數</a>
            </li><li class="toc-3 astro-QTOKGA5Y">
              <a href="#合理使用泛型" class="astro-QTOKGA5Y">合理使用泛型</a>
            </li><li class="toc-2 astro-QTOKGA5Y">
              <a href="#參考文件" class="astro-QTOKGA5Y">參考文件</a>
            </li>
      </ul>
    </div>
    <h2 id="總結">總結</h2>
<p>此篇是 Good Code, Bad Code: Think like a software engineer 第九章（Make code reusable and generalizable）的閱讀筆記。本章提出以下「可提昇程式碼複用性、泛用性」的技巧：</p>
<ol>
<li>避免假設</li>
<li>避免全域狀態</li>
<li>謹慎處理預設回傳內容</li>
<li>避免非必要的參數</li>
<li>合理使用泛型</li>
</ol>
<h2 id="筆記">筆記</h2>
<h3 id="避免假設">避免假設</h3>
<p>避免的理由：一個功能如果需要先滿足特定條件（假設）才能正常運作，代表該功能能被運用的場合會變少（相較於「沒有假設」的功能）。</p>
<p>更進一步來說，如果一個功能「本來就僅為了服務特定情境而生」，那麼本書建議該功能的命名最好要能讓使用者一看就知道「使用此功能需要滿足一些條件」，避免不知情者誤用。</p>
<p>建議：越是基礎、底層的功能，一旦未來可能被重複使用的場合越多，此類功能最好避免包含假設（或是前置條件）。</p>
<h3 id="避免全域狀態">避免全域狀態</h3>
<blockquote>
<p>Using global state can make code reuse completely unsafe. The fact that global state is used <strong>might not be apparent to another engineer</strong>, so if they do try to reuse the code, this might result in weird behavior and bugs. If we need to share state between different parts of a program, it’s usually safer to do this in a more controlled way using <strong>dependency injection</strong>.</p>
</blockquote>
<p>「全域」代表一個資料可能會在各處被操作，而這個操作可能不是開發者原本在設計功能時希望發生的事情。在設計一個功能時如果想要增加其複用或泛用性，則應該避免在功能中與全域狀態互動。</p>
<p>全域資料的替代方案：本書建議透過依賴注入來產生獨立的狀態資料，避免資料遭到意外污染。</p>
<h3 id="謹慎處理預設回傳內容">謹慎處理預設回傳內容</h3>
<p>情境如下：一個會回傳使用者照片的功能，如果該使用者沒有提供照片，則回傳預設圖檔。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">getAvatarImageUrl</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">user</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">User</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> user.avatar_image_url</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> user.avatar_image_url</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'asset/default_avatar_image.jpg'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>現在所有呼叫 <code>getAvatarImageUrl</code> 的程式碼都必定會收到一組照片的 url，但不會知道這組 url 是使用者上傳、或是系統預設的圖片。如果在整個服務的某些地方，我們想要「根據使用者是否有上傳照片」來執行不同的行動，那麼 <code>getAvatarImageUrl</code> 就無法滿足我們的需求。</p>
<p>建議：撰寫功能時，如果此功能未來可能會被複用，可多加考慮回傳預設值是否合理。以上述的例子而言，讓 <code>getAvatarImageUrl</code> 在使用者未上傳照片時回傳 <code>null</code> 是個比較有彈性的設計。</p>
<h3 id="避免非必要的參數">避免非必要的參數</h3>
<p>情境如下：一個設定 <code>Text</code> 顏色的功能，接收兩個參數 <code>text: Text</code> 與 <code>style: TextStyle</code>。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Text</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">content</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">style</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">TextStyle</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">TextStyle</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">fontSize</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">fontFamily</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">color</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Color</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Color</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">red</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">green</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">blue</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">setTextColor</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">text</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Text</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">style</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">TextStyle</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">clonedText</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> lodash.</span><span style="color: #B392F0">cloneDeep</span><span style="color: #E1E4E8">(text);</span></span>
<span class="line"><span style="color: #E1E4E8">  clonedText.style.color </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> style.color;</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> clonedText;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>事實上 <code>setTextColor</code> 不需要用到完整的 <code>style</code> 物件來設定 <code>text</code> 的顏色，此功能事實上只需要 <code>style.color</code> 即可。但目前的設計會讓所有呼叫 <code>setTextColor</code> 的程式碼都需要提供一個完整的 <code>TextStyle</code> 物件才能順利修改 <code>text</code> 的顏色。</p>
<p>建議：盡量讓一個功能只取用真正必要的內容，會讓該功能的泛用性變的更高。以 <code>setTextColor</code> 而言，第二個參數只接收 <code>Color</code> 型別的資料即可。</p>
<h3 id="合理使用泛型">合理使用泛型</h3>
<p>參考以下改寫自書中的範例。下方 <code>Queue</code> 被設計成能夠容納各種類型（而不是只能保存 <code>string</code> 或 <code>number</code>，有限定類型）的資料結構。整個服務中需要此類結構的地方都可複用 <code>Queue</code>，不用擔心型別限制。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Queue</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">list</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">add</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">newValue</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">.list.</span><span style="color: #B392F0">push</span><span style="color: #E1E4E8">(newValue);</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">getRandomlyRemoveOneItemList</span><span style="color: #E1E4E8">() {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">!</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">.list.</span><span style="color: #79B8FF">length</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">null</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">randomIndex</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">floor</span><span style="color: #E1E4E8">(Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">*</span><span style="color: #E1E4E8"> (</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">.list.</span><span style="color: #79B8FF">length</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">));</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">cloneList</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cloneDeep</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">.list);</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> cloneList.</span><span style="color: #B392F0">splice</span><span style="color: #E1E4E8">(randomIndex, </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>泛型較能對應日後各類使用情境，在設計基礎功能時，若情境允許，則可使用泛型來增加程式碼的被運用的彈性。</p>
<h2 id="參考文件">參考文件</h2>
<ul>
<li><a href="https://www.manning.com/books/good-code-bad-code">Manning: Good Code, Bad Code</a></li>
</ul>
  </div>

      <footer class="astro-QLGQ3ONJ">Tzu Yin (Charlie) 🦊 Made in Taiwan</footer>
    </section>
  </body></html>